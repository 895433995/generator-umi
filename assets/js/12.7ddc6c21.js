(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{259:function(s,t,a){"use strict";a.r(t);var e=a(32),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由"}},[s._v("#")]),s._v(" 路由")]),s._v(" "),a("p",[s._v("脚手架使用"),a("a",{attrs:{href:"https://umijs.org/docs/convention-routing",target:"_blank",rel:"noopener noreferrer"}},[s._v("约定式路由"),a("OutboundLink")],1),s._v("，并对其功能进行了扩展。")]),s._v(" "),a("h2",{attrs:{id:"路由形态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由形态"}},[s._v("#")]),s._v(" 路由形态")]),s._v(" "),a("p",[s._v("脚手架中，路由分两种形态：")]),s._v(" "),a("ul",[a("li",[s._v("OpenPage：无需登录就能访问的开放页面。判定标准，以 "),a("code",[s._v("/o/")]),s._v(" 开始的路由会被判定为 OpenPage。例如：登录页面("),a("code",[s._v("/o/login")]),s._v(")")]),s._v(" "),a("li",[s._v("AuthRequiredPage：必须登录后才能访问的页面。判定标准，以 非 "),a("code",[s._v("/o/")]),s._v(" 开始的路由会被判定为 AuthRequiredPage。未登录时访问此类路由，会跳转到登录页。例如：分析页面("),a("code",[s._v("/dashboard/analysis")]),s._v(")")])]),s._v(" "),a("h2",{attrs:{id:"路由权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由权限"}},[s._v("#")]),s._v(" 路由权限")]),s._v(" "),a("p",[s._v("权限路由指 AuthRequiredPage 形态下的权限控制细节。例如：页面 A 只要求登录就能访问；页面 B 即使登录后，还要求用户具备相应权限才能访问，否则提示 "),a("code",[s._v("403")]),s._v(" 。")]),s._v(" "),a("p",[s._v("下面，打开 "),a("code",[s._v("src/pages/dashboard/analysis/index.tsx")]),s._v(", 按照 "),a("code",[s._v("umi")]),s._v(" 约定式路由的规则我们知道，这个页面对应的路由是 "),a("code",[s._v("/dashboard/analysis")]),s._v("，它以 非 "),a("code",[s._v("/o/")]),s._v(" 开始，所以是 AuthRequiredPage，即必须登录后才能访问的页面。那 "),a("strong",[s._v("权限")]),s._v(" 具体在哪里控制，请继续往下看，我们就以分析页面为例解释权限控制：")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" React "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'react'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Analysis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("analysis"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定本页面 title 使用 locales/ 下对应语言的替换")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 详情在 国际化 章节里看吧")]),s._v("\nAnalysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("title "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ANALYSIS_TITLE'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定使用 PRO_LAYOUT 布局，详情在 布局 章节里看吧")]),s._v("\nAnalysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("layout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PRO_LAYOUT'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里为access指定了需要的权限为 ：canReadDashboardAnalysis")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 可以去 src/access.ts 里查看，这个值会在后端返回的 user.permissions")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 里包含 VIEW_DASHBOARD_ANALYSIS 权限时 会被置为 true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 即：只有登录用户有 VIEW_DASHBOARD_ANALYSIS 权限时，才能打开本页面")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 否则会被转到 内置的 403 页面")]),s._v("\nAnalysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("access "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'canReadDashboardAnalysis'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" Analysis\n")])])]),a("blockquote",[a("p",[s._v("找到 "),a("code",[s._v("mock/user.js")]),s._v(", 把 "),a("code",[s._v("VIEW_DASHBOARD_ANALYSIS")]),s._v(" 改成其他任意字符，刷新页面，尝试访问 "),a("code",[s._v("/dashboard/analysis")]),s._v("，你会看到如下界面：")])]),s._v(" "),a("img",{attrs:{src:s.$withBase("/403.png"),alt:"403"}}),s._v(" "),a("blockquote",[a("p",[s._v("判定是否具有页面访问权限的操作之所以单独放在 "),a("code",[s._v("src/access.ts")]),s._v(" 里，就是考虑到后端的 api 不一定和脚手架相同而需要变更，所以在 "),a("code",[s._v("src/access.ts")]),s._v(" 里统一处理。")])]),s._v(" "),a("p",[s._v("那么，如果页面没有额外的权限要求，仅登录后就能访问，例如：个人信息页。该如何处理？简单，只要删除 页面里的 "),a("code",[s._v("页面组件.access = '指定权限'")]),s._v(" 这句话就行了。")]),s._v(" "),a("h2",{attrs:{id:"不存在路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不存在路由"}},[s._v("#")]),s._v(" 不存在路由")]),s._v(" "),a("p",[s._v("如果访问的页面不存在，脚手架自带了 404 组件，如下：")]),s._v(" "),a("p",[s._v("在 OpenPage 形态下，显示：")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/open_404.png"),alt:"open 404"}}),s._v(" "),a("p",[s._v("在 AuthRequiredPage 形态下，显示：")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/pro_404.png"),alt:"pro 404"}}),s._v(" "),a("p",[s._v("有朋友可能会问，都是不存在的路由，脚手架里是如何判定应该使用哪个布局的？ 那就得熟悉下一章节，"),a("RouterLink",{attrs:{to:"/guide/layout.html#布局处理器列表"}},[s._v("布局-布局处理器列表")])],1)])}),[],!1,null,null,null);t.default=n.exports}}]);